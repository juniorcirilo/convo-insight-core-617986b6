<!DOCTYPE html>
<html>
<head>
    <title>Basic Supabase Test</title>
</head>
<body>
    <h1>Basic Supabase Connection Test</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        // Test basic fetch to Supabase API
        async function testBasicConnection() {
            try {
                results.innerHTML += '<p>Testing basic connection to Supabase...</p>';
                
                const response = await fetch('http://127.0.0.1:54321/rest/v1/', {
                    method: 'GET',
                    headers: {
                        'apikey': 'sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    results.innerHTML += '<p style="color: green;">✅ Basic connection: OK</p>';
                } else {
                    results.innerHTML += '<p style="color: red;">❌ Basic connection failed: ' + response.status + '</p>';
                }
            } catch (error) {
                results.innerHTML += '<p style="color: red;">❌ Basic connection error: ' + error.message + '</p>';
            }
        }
        
        // Test auth endpoint
        async function testAuthEndpoint() {
            try {
                results.innerHTML += '<p>Testing auth endpoint...</p>';
                
                const response = await fetch('http://127.0.0.1:54321/auth/v1/token?grant_type=password', {
                    method: 'POST',
                    headers: {
                        'apikey': 'sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'admin@livechat.app',
                        password: 'livechat'
                    })
                });
                
                results.innerHTML += '<p>Response status: ' + response.status + '</p>';
                results.innerHTML += '<p>Response headers: ' + JSON.stringify([...response.headers.entries()]) + '</p>';
                
                const responseText = await response.text();
                results.innerHTML += '<p>Raw response: ' + responseText + '</p>';
                
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    results.innerHTML += '<p style="color: red;">❌ JSON parse error: ' + parseError.message + '</p>';
                    return;
                }
                
                if (response.ok && data.access_token) {
                    results.innerHTML += '<p style="color: green;">✅ Auth endpoint: SUCCESS</p>';
                    results.innerHTML += '<p>User: ' + data.user.email + '</p>';
                } else {
                    results.innerHTML += '<p style="color: red;">❌ Auth failed: ' + (data.error_description || data.error || data.message || 'Unknown error') + '</p>';
                    results.innerHTML += '<p>Full response data: ' + JSON.stringify(data) + '</p>';
                }
            } catch (error) {
                results.innerHTML += '<p style="color: red;">❌ Auth error: ' + error.message + '</p>';
                results.innerHTML += '<p>Error stack: ' + error.stack + '</p>';
            }
        }
        
        // Run tests
        testBasicConnection().then(() => {
            return testAuthEndpoint();
        });
    </script>
</body>
</html>